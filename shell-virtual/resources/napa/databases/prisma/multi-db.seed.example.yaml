variables:
  CHAIN: ROOT-ORG
  BASE_STATUS: active

databases:
  api_wallet:
    db: api_wallet
    target: api_wallet
    variables:
      MAIN_ALIAS: wallet-main
    tables:
      Party:
        upsertBy: [name]
        rows:
          - name: "{{vars.MAIN_ALIAS}}"
            type: organization
            chain: "{{vars.CHAIN}}"
    operations:
      - type: upsert
        table: Account
        upsertBy: [externalReference]
        rows:
          - externalReference: "{{vars.MAIN_ALIAS}}-USD"
            name: "{{vars.MAIN_ALIAS}}"
            chain: "{{vars.CHAIN}}"
            currencyId: USD
            status: "{{vars.BASE_STATUS}}"
            availableBalance: 1000000
            depositBalance: 1000000
            payoutBalance: 0
            bonusBalance: 0
            pendingBalance: 0
            blockedBalance: 0
      - type: update
        table: Account
        where:
          externalReference: "{{vars.MAIN_ALIAS}}-USD"
        set:
          status: inactive
          updatedAt:
            sql: NOW()
      - type: delete
        table: Account
        where:
          externalReference: "{{vars.MAIN_ALIAS}}-LEGACY"

  api_affiliations:
    db: api_affiliations
    target: api_affiliations
    operations:
      - type: insert
        table: Currency
        rows:
          - id: TEST
            name: Test Currency
            symbol: T
            decimalPrecision: 0.01
            type: fiat
            updatedAt:
              sql: NOW()
